# Telegram Client для Symbian - Документація проекту

## Огляд проекту

**Назва:** Telegram Gateway для Symbian S60

**Версія:** 1.0

**Дата:** Жовтень 2025

**Мета:** Створення функціонального Telegram-клієнта для застарілих мобільних телефонів на базі Symbian OS через проміжний серверний шлюз.

---

## Призначення проекту

### Проблема

Старі мобільні телефони з операційною системою Symbian S60 3rd Edition мають обмежені технічні можливості:

- **Слабкий процесор:** ARM11 ~369 MHz
- **Обмежена пам'ять:** ~128 MB RAM
- **Застаріла платформа:** Symbian OS 9.x, Java ME MIDP 2.0
- **Відсутність сучасних протоколів:** Немає підтримки WebSocket, складної криптографії
- **Відсутність офіційної підтримки:** Telegram не має клієнта для Symbian

При цьому, користувачі таких пристроїв потребують доступу до сучасних месенджерів, зокрема Telegram, для:
- Базової комунікації
- Отримання важливих повідомлень
- Використання як резервного пристрою зв'язку
- Ностальгії та хобі (колекціонування ретро-техніки)

### Рішення

Проект реалізує **архітектуру клієнт-сервер-шлюз**, де складна логіка роботи з Telegram виконується на сервері, а Symbian-пристрій отримує спрощений інтерфейс взаємодії через легкий HTTP-протокол.

---

## Архітектура системи

### Загальна схема

```
┌─────────────┐         HTTP/HTTPS         ┌─────────────┐       MTProto        ┌─────────────┐
│             │  ←─────────────────────→   │             │  ←──────────────→   │             │
│   Symbian   │     JSON API Requests      │  Go Server  │   Telegram API      │  Telegram   │
│   Device    │     Long Polling           │  (Gateway)  │   with api_id       │  Servers    │
│  (Client)   │                             │             │                      │             │
└─────────────┘                             └─────────────┘                      └─────────────┘
     │                                            │
     │                                            │
     └─── Java ME / Symbian C++              └─── Go + gotd/td
          Simple HTTP Client                      MTProto Implementation
          Local Cache (RMS)                       Session Management
          UI Rendering                            Message Queue
                                                  Database
```

### Компоненти системи

#### 1. **Symbian Client (Клієнтська частина)**

**Платформа:**
- Symbian OS 9.x, S60 3rd Edition
- Java ME (MIDP 2.0) або Symbian C++

**Функції:**
- Простий графічний інтерфейс для перегляду чатів і повідомлень
- HTTP/HTTPS клієнт для зв'язку з сервером
- Локальне кешування даних (RecordStore в Java ME)
- Long polling для отримання сповіщень про нові повідомлення
- Управління сесією користувача

**Обмеження:**
- Мінімальне використання пам'яті
- Економія трафіку даних
- Оптимізація батареї через long polling

#### 2. **Go Server (Серверний шлюз)**

**Платформа:**
- Go 1.20+
- Фреймворк: Gin (HTTP-сервер)
- Бібліотека: gotd/td (Telegram MTProto)

**Функції:**
- **Проксування запитів:** Приймає HTTP-запити від Nokia та перетворює їх у MTProto запити до Telegram
- **Авторизація:** Управління сесіями користувачів через токени
- **Long polling:** Утримання з'єднань для миттєвого надсилання нових повідомлень
- **Кешування:** Зберігання сесій і повідомлень для швидкодії
- **Rate limiting:** Захист від перевантаження API Telegram
- **Управління декількома користувачами:** Підтримка одночасних сесій

**Інфраструктура:**
- База даних: PostgreSQL / Redis (для production)
- HTTPS з SSL сертифікатами (Let's Encrypt)
- Логування та моніторинг

#### 3. **Telegram API**

**Протокол:** MTProto 2.0

**Аутентифікація:**
- `api_id` та `api_hash` (отримані через https://my.telegram.org)
- Сесійні ключі для кожного користувача

**Функціонал:**
- Авторизація користувачів через SMS-код
- Підтримка 2FA (двофакторної аутентифікації)
- Отримання списку чатів
- Читання та відправка повідомлень
- Позначення повідомлень як прочитаних
- Real-time сповіщення про нові події

---

## Принцип роботи

### Процес авторизації

#### Без 2FA:
```
1. Користувач вводить номер телефону на Symbian-пристрої
   ↓
2. Клієнт → POST /auth/request-code → Go Server
   ↓
3. Go Server → Telegram API (MTProto): SendCode
   ↓
4. Telegram відправляє SMS-код користувачу
   ↓
5. Користувач вводить код на Symbian-пристрої
   ↓
6. Клієнт → POST /auth/login (phone, code) → Go Server
   ↓
7. Go Server → Telegram API: SignIn
   ↓
8. Telegram підтверджує авторизацію
   ↓
9. Go Server генерує session_token
   ↓
10. Клієнт зберігає session_token локально (RMS)
```

#### З 2FA (двофакторна аутентифікація):
```
1-6. [Як у варіанті без 2FA]
   ↓
7. Go Server → Telegram API: SignIn
   ↓
8. Telegram повідомляє: потрібен пароль 2FA
   ↓
9. Go Server → Клієнт: {"status": "password_required", "needs_password": true}
   ↓
10. Користувач вводить пароль 2FA
   ↓
11. Клієнт → POST /auth/password (phone, password) → Go Server
   ↓
12. Go Server → Telegram API: перевірка пароля
   ↓
13. Telegram підтверджує авторизацію
   ↓
14. Go Server генерує session_token
   ↓
15. Клієнт зберігає session_token локально (RMS)
```

### Процес отримання чатів

```
1. Клієнт → GET /api/chats (with Authorization header) → Go Server
   ↓
2. Go Server перевіряє session_token
   ↓
3. Go Server → Telegram API: GetDialogs
   ↓
4. Telegram повертає список чатів
   ↓
5. Go Server формує JSON-відповідь
   ↓
6. Клієнт отримує список чатів
   ↓
7. Клієнт кешує дані локально і показує в UI
```

### Процес Long Polling (отримання нових повідомлень)

```
┌─ Клієнт відкриває з'єднання: GET /api/poll
│  ↓
│  Go Server створює канал для користувача
│  ↓
│  ┌───────────────────────────────────────┐
│  │ Сервер чекає 50 секунд:               │
│  │                                        │
│  │ • Якщо приходить нове повідомлення    │
│  │   від Telegram → одразу відповідає    │
│  │                                        │
│  │ • Якщо 50 секунд минуло без подій     │
│  │   → відповідає HTTP 204 (No Content) │
│  └───────────────────────────────────────┘
│  ↓
│  Клієнт отримує відповідь:
│  • Якщо 200 OK → Показує сповіщення
│  • Якщо 204 → Нічого не відбулось
│  ↓
└─ Клієнт одразу перепідключається (цикл повторюється)
```

**Переваги long polling:**
- Мінімальна затримка отримання повідомлень (до 1 секунди)
- Економія батареї (одне тривале з'єднання vs багато коротких)
- Менше навантаження на сервер
- Працює на будь-якому HTTP-клієнті

### Процес відправки повідомлення

```
1. Користувач пише текст на Symbian-пристрої
   ↓
2. Клієнт → POST /api/send (chat_id, text) → Go Server
   ↓
3. Go Server → Telegram API: SendMessage
   ↓
4. Telegram доставляє повідомлення
   ↓
5. Go Server → Клієнт: 200 OK (message_id, timestamp)
   ↓
6. Клієнт додає повідомлення в локальний кеш
   ↓
7. Клієнт оновлює UI
```

---

## Технічні деталі

### API Endpoints

Детальна документація API доступна в [API.md](API.md)

| Метод | Endpoint | Призначення |
|-------|----------|-------------|
| POST | `/auth/request-code` | Запит SMS-коду авторизації |
| POST | `/auth/login` | Вхід з кодом, отримання токену |
| POST | `/auth/password` | Вхід з паролем 2FA (якщо потрібно) |
| POST | `/auth/logout` | Завершення сесії |
| GET | `/api/chats` | Список чатів користувача |
| GET | `/api/messages/:chat_id` | Повідомлення конкретного чату |
| POST | `/api/send` | Відправка повідомлення |
| POST | `/api/mark-read` | Позначити повідомлення як прочитані |
| GET | `/api/poll` | Long polling для нових повідомлень |

### Формат даних

**Приклад JSON-відповіді (список чатів):**
```json
{
  "chats": [
    {
      "id": 123456789,
      "name": "John Doe",
      "last_message": "See you tomorrow!",
      "unread_count": 3,
      "last_update_time": "2025-10-06T14:30:00Z",
      "type": "user"
    }
  ],
  "count": 1
}
```

**Приклад JSON-відповіді (авторизація з 2FA):**
```json
{
  "status": "password_required",
  "message": "Обліковий запис захищено 2FA паролем",
  "needs_password": true
}
```

### Безпека

1. **HTTPS обов'язково** - всі дані передаються в зашифрованому вигляді
2. **Токени сесії** - замість збереження паролів
3. **Timeout сесій** - автоматичне завершення після 30 хв неактивності
4. **Rate limiting** - захист від DDoS та зловживань
5. **Валідація даних** - перевірка всіх вхідних даних на сервері

### Оптимізація

**Для Symbian-пристроїв:**
- Мінімальний розмір JSON-відповідей
- Локальне кешування в RecordStore
- Завантаження повідомлень порціями (20-30 за раз)
- Стиснення зображень (якщо підтримується)

**Для сервера:**
- Пул з'єднань до Telegram API
- Redis для кешування часто запитуваних даних
- Горутини для обробки кожного користувача
- Graceful shutdown

---

## Переваги рішення

### 1. **Технічні переваги**

✅ **Простота клієнта:** Nokia виконує тільки HTTP-запити та рендеринг UI
✅ **Масштабованість:** Один сервер може обслуговувати десятки/сотні користувачів
✅ **Гнучкість:** Оновлення логіки без зміни клієнта на телефоні
✅ **Надійність:** Складна логіка на сервері, легше налагоджувати
✅ **Безпека:** MTProto шифрування + HTTPS

### 2. **Користувацькі переваги**

✅ **Доступність:** Telegram на старих телефонах без покупки нового
✅ **Економія:** Використання наявного обладнання
✅ **Надійність:** Старі Symbian-телефони відомі своєю довговічністю
✅ **Ностальгія:** Можливість використовувати улюблені пристрої
✅ **Резервний зв'язок:** Запасний засіб комунікації

### 3. **Бізнес-переваги**

✅ **Низька вартість розробки:** Не потрібно переписувати MTProto з нуля
✅ **Швидкий розвиток:** Використання готових бібліотек (gotd/td)
✅ **Легка підтримка:** Основна логіка на сервері
✅ **Можливість монетизації:** Premium функції, підписки

---

## Обмеження та компроміси

### Технічні обмеження

⚠️ **Немає voice/video дзвінків:** Symbian не підтримує сучасні кодеки
⚠️ **Обмежені медіафайли:** Складно відображати складні медіа (GIF, відео)
⚠️ **Повільний UI:** Обмеження швидкодії старого процесора
⚠️ **Залежність від сервера:** Без сервера клієнт не працює

### Функціональні обмеження

⚠️ **Основні функції:** Тільки текстові повідомлення та прості зображення
⚠️ **Групові чати:** Обмежена функціональність (без адмін-панелі)
⚠️ **Боти:** Обмежена підтримка інтерактивних кнопок
⚠️ **Stories/Channels:** Може бути не реалізовано спочатку

---

## Варіанти використання

### Use Case 1: Особистий месенджер
**Сценарій:** Користувач має старий Symbian-телефон і хоче спілкуватись в Telegram

**Процес:**
1. Встановлює клієнт на пристрій
2. Авторизується зі своїм номером
3. Отримує доступ до всіх чатів
4. Може відправляти/отримувати повідомлення

### Use Case 2: Резервний пристрій
**Сценарій:** Основний смартфон розрядився/зламався

**Процес:**
1. Використовує Symbian-телефон як запасний пристрій
2. Швидка авторизація (токен збережений)
3. Отримує важливі повідомлення
4. Може відповісти на термінові запити

### Use Case 3: Ретро-ентузіасти
**Сценарій:** Колекціонери старої техніки хочуть використовувати Symbian-пристрої

**Процес:**
1. Встановлюють клієнт заради цікавості
2. Використовують для демонстрації можливостей
3. Ностальгія за старими інтерфейсами

---

## Розвиток проекту

### MVP (Мінімальний життєздатний продукт)

**Фаза 1:**
- ✅ Авторизація через SMS-код
- ✅ Підтримка 2FA паролів
- ✅ Список чатів
- ✅ Читання повідомлень
- ✅ Відправка текстових повідомлень
- ✅ Long polling для сповіщень
- ✅ Позначення повідомлень як прочитаних

### Майбутні можливості

**Фаза 2:**
- 📷 Відправка/отримання зображень (стиснутих)
- 📁 Завантаження файлів (обмежено розміром)
- 🔍 Пошук по повідомленнях
- ⚙️ Налаштування (тихий режим, частота polling)

**Фаза 3:**
- 👥 Створення групових чатів
- 📢 Підписка на канали
- 🤖 Взаємодія з ботами
- 🌐 Мультимовність інтерфейсу

**Фаза 4:**
- 🔐 End-to-end encryption (Secret Chats)
- 📊 Статистика використання
- 🎨 Кастомізація UI
- 📱 Підтримка інших Symbian пристроїв

---

## Вимоги до розгортання

### Серверна частина

**Мінімальні вимоги:**
- Go 1.20+
- Telegram API credentials (api_id, api_hash)
- 100MB вільного місця

**Рекомендовані вимоги для production:**
- VPS/Cloud Server (1 vCPU, 1GB RAM)
- PostgreSQL 13+ або Redis 6+ (для зберігання сесій)
- SSL сертифікат (Let's Encrypt)
- Доменне ім'я
- 2 vCPU, 2GB RAM
- SSD диск
- Backup система
- Моніторинг (Prometheus/Grafana)

### Клієнтська частина

**Вимоги до телефону:**
- Пристрої на базі Symbian S60 3rd Edition
- Java MIDP 2.0 або можливість запуску Symbian C++ додатків
- Доступ до інтернету (GPRS/3G/WiFi)
- Мінімум 5MB вільної пам'яті

---

## Висновок

Проект **Telegram Client для Symbian** демонструє можливість надати сучасні комунікаційні можливості застарілим пристроям через розумну архітектуру клієнт-сервер. Використовуючи Go як проміжний шлюз, ми вирішуємо проблеми обмежених ресурсів старих телефонів і надаємо користувачам доступ до Telegram без необхідності купувати новий пристрій.

Проект є ідеальним рішенням для:
- Любителів ретро-техніки
- Людей з обмеженим бюджетом
- Ситуацій, де потрібен надійний резервний пристрій зв'язку
- Освітніх цілей (вивчення мобільної розробки та API)

**Головна цінність:** Продовження життя старої техніки та надання доступу до сучасних технологій кожному.